# ä»»åŠ¡å®Œæˆè¯´æ˜æ–‡æ¡£

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

æœ¬æ¬¡ä»»åŠ¡å®Œæˆäº†ä¸¤ä¸ªä¸»è¦åŠŸèƒ½:

1. **ä¼˜åŒ– `scripts/init_database.py` æ–‡ä»¶** - æ·»åŠ å¤šåœºæ™¯åˆå§‹åŒ–æ”¯æŒ
2. **åˆ›å»º `menu_pages/auth_test_page.py` é¡µé¢** - å…¨é¢æµ‹è¯•è®¤è¯æƒé™ç³»ç»Ÿ

---

## ğŸ¯ ä»»åŠ¡ä¸€: å¤šåœºæ™¯æ•°æ®åº“åˆå§‹åŒ–

### åŠŸèƒ½è¯´æ˜

åœ¨ `scripts/init_database.py` ä¸­å®ç°äº†ä¸‰ç§å¸¸ç”¨åº”ç”¨åœºæ™¯çš„åˆå§‹åŒ–é…ç½®:

#### 1. Default åœºæ™¯ - é€šç”¨ Web åº”ç”¨

**é€‚ç”¨èŒƒå›´**: ä¸€èˆ¬çš„ä¸šåŠ¡ç³»ç»Ÿã€ç®¡ç†åå°

**è§’è‰²å®šä¹‰**:

- `admin` - ç³»ç»Ÿç®¡ç†å‘˜ (æ‰€æœ‰æƒé™)
- `user` - æ™®é€šç”¨æˆ· (åŸºç¡€æƒé™)
- `editor` - ç¼–è¾‘è€… (å¯åˆ›å»ºå’Œç¼–è¾‘å†…å®¹)
- `viewer` - æŸ¥çœ‹è€… (åªè¯»æƒé™)

**æƒé™åˆ†ç±»**:

- ç³»ç»Ÿæƒé™: `system.manage`, `user.manage`, `role.manage`
- å†…å®¹æƒé™: `content.create`, `content.edit`, `content.delete`, `content.view`
- ä¸ªäººèµ„æ–™: `profile.view`, `profile.edit`, `password.change`

**æµ‹è¯•è´¦æˆ·**:

```
admin / admin123    - ç®¡ç†å‘˜
user / user123      - æ™®é€šç”¨æˆ·
editor / editor123  - ç¼–è¾‘è€…
viewer / viewer123  - æŸ¥çœ‹è€…
```

---

#### 2. CMS åœºæ™¯ - å†…å®¹ç®¡ç†ç³»ç»Ÿ

**é€‚ç”¨èŒƒå›´**: åšå®¢ã€æ–°é—»ç½‘ç«™ã€æ–‡æ¡£å‘å¸ƒå¹³å°

**è§’è‰²å®šä¹‰**:

- `admin` - è¶…çº§ç®¡ç†å‘˜ (æ‰€æœ‰æƒé™)
- `editor_chief` - ä¸»ç¼– (å®¡æ ¸å’Œå‘å¸ƒ)
- `author` - ä½œè€… (æ’°å†™æ–‡ç« )
- `contributor` - æŠ•ç¨¿è€… (æäº¤è‰ç¨¿)
- `reader` - è¯»è€… (æµè§ˆå†…å®¹)

**æƒé™åˆ†ç±»**:

- ç³»ç»Ÿç®¡ç†: `system.manage`, `user.manage`, `role.manage`
- æ–‡ç« ç®¡ç†: `article.create`, `article.edit`, `article.publish`, `article.delete`...
- è¯„è®ºç®¡ç†: `comment.create`, `comment.moderate`, `comment.delete`
- åˆ†ç±»æ ‡ç­¾: `category.manage`, `tag.manage`
- åª’ä½“åº“: `media.upload`, `media.manage`
- ä¸ªäººèµ„æ–™: `profile.view`, `profile.edit`

**æµ‹è¯•è´¦æˆ·**:

```
admin / admin123         - è¶…çº§ç®¡ç†å‘˜
chief / chief123         - ä¸»ç¼–
author / author123       - ä½œè€…
contributor / contributor123 - æŠ•ç¨¿è€…
```

---

#### 3. ERP åœºæ™¯ - ä¼ä¸šèµ„æºè®¡åˆ’ç³»ç»Ÿ

**é€‚ç”¨èŒƒå›´**: ä¼ä¸šå†…éƒ¨ç®¡ç†ã€è´¢åŠ¡ã€é‡‡è´­ã€é”€å”®ç­‰ä¸šåŠ¡

**è§’è‰²å®šä¹‰**:

- `admin` - ç³»ç»Ÿç®¡ç†å‘˜ (æ‰€æœ‰æƒé™)
- `ceo` - CEO (æŸ¥çœ‹æ‰€æœ‰æ•°æ®)
- `finance_manager` - è´¢åŠ¡ç»ç†
- `purchase_manager` - é‡‡è´­ç»ç†
- `sales_manager` - é”€å”®ç»ç†
- `warehouse_manager` - ä»“åº“ç®¡ç†å‘˜
- `employee` - æ™®é€šå‘˜å·¥

**æƒé™åˆ†ç±»**:

- ç³»ç»Ÿç®¡ç†: `system.manage`, `user.manage`, `role.manage`
- è´¢åŠ¡ç®¡ç†: `finance.view`, `finance.manage`, `invoice.create`, `payment.manage`
- é‡‡è´­ç®¡ç†: `purchase.view`, `purchase.create`, `purchase.approve`, `supplier.manage`
- é”€å”®ç®¡ç†: `sales.view`, `sales.create`, `sales.approve`, `customer.manage`
- åº“å­˜ç®¡ç†: `inventory.view`, `inventory.manage`, `warehouse.in`, `warehouse.out`
- æŠ¥è¡¨æƒé™: `report.view`, `report.export`
- ä¸ªäººèµ„æ–™: `profile.view`, `profile.edit`

**æµ‹è¯•è´¦æˆ·**:

```
admin / admin123     - ç³»ç»Ÿç®¡ç†å‘˜
ceo / ceo123         - CEO
finance / finance123 - è´¢åŠ¡ç»ç†
purchase / purchase123 - é‡‡è´­ç»ç†
```

---

### ä½¿ç”¨æ–¹æ³•

#### åŸºæœ¬å‘½ä»¤

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
python scripts/init_database.py --help

# é»˜è®¤åœºæ™¯åˆå§‹åŒ–
python scripts/init_database.py --scenario default

# CMSåœºæ™¯åˆå§‹åŒ–å¹¶åˆ›å»ºæµ‹è¯•æ•°æ®
python scripts/init_database.py --scenario cms --test-data

# ERPåœºæ™¯åˆå§‹åŒ–å¹¶é‡ç½®æ•°æ®åº“
python scripts/init_database.py --scenario erp --reset --test-data

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
python scripts/init_database.py --scenario default --verbose --test-data
```

#### å‚æ•°è¯´æ˜

- `--scenario` : é€‰æ‹©åœºæ™¯ (`default`|`cms`|`erp`)
- `--test-data` : åˆ›å»ºæµ‹è¯•ç”¨æˆ·è´¦æˆ·
- `--reset` : é‡ç½®ç°æœ‰æ•°æ®åº“
- `--verbose` : æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—è¾“å‡º

---

### ä»£ç æ¶æ„

#### æ ¸å¿ƒç±»è®¾è®¡

```python
class ScenarioConfig:
    """åœºæ™¯é…ç½®åŸºç±»"""
    - get_roles() : è·å–åœºæ™¯è§’è‰²é…ç½®
    - get_permissions() : è·å–åœºæ™¯æƒé™é…ç½®
    - get_role_permissions() : è·å–è§’è‰²æƒé™æ˜ å°„

class DefaultScenario(ScenarioConfig):
    """é»˜è®¤åœºæ™¯é…ç½®"""

class CMSScenario(ScenarioConfig):
    """CMSåœºæ™¯é…ç½®"""

class ERPScenario(ScenarioConfig):
    """ERPåœºæ™¯é…ç½®"""
```

#### åœºæ™¯æ³¨å†Œè¡¨

```python
SCENARIOS = {
    'default': DefaultScenario(),
    'cms': CMSScenario(),
    'erp': ERPScenario(),
}
```

---

## ğŸ§ª ä»»åŠ¡äºŒ: è®¤è¯ç³»ç»Ÿæµ‹è¯•é¡µé¢

### åŠŸèƒ½æ¨¡å—

#### 1. å½“å‰ç”¨æˆ·ä¿¡æ¯å±•ç¤º

- æ˜¾ç¤ºç”¨æˆ·åã€å…¨åã€é‚®ç®±
- æ˜¾ç¤ºæ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜
- æ˜¾ç¤ºè´¦æˆ·æ¿€æ´»çŠ¶æ€
- åˆ—å‡ºæ‰€æœ‰è§’è‰²
- ç»Ÿè®¡æ‹¥æœ‰çš„æƒé™æ•°é‡

#### 2. æƒé™æ£€æŸ¥æµ‹è¯•

å¿«é€Ÿæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ä»¥ä¸‹å¸¸ç”¨æƒé™:

- `system.manage` - ç³»ç»Ÿç®¡ç†
- `user.manage` - ç”¨æˆ·ç®¡ç†
- `role.manage` - è§’è‰²ç®¡ç†
- `content.create` - åˆ›å»ºå†…å®¹
- `content.edit` - ç¼–è¾‘å†…å®¹
- `content.delete` - åˆ é™¤å†…å®¹
- `content.view` - æŸ¥çœ‹å†…å®¹
- `profile.view` - æŸ¥çœ‹ä¸ªäººèµ„æ–™
- `profile.edit` - ç¼–è¾‘ä¸ªäººèµ„æ–™

#### 3. æ•°æ®åº“æ•°æ®æŸ¥çœ‹

æä¾›ä¸‰ä¸ªæŒ‰é’®å¿«é€ŸæŸ¥çœ‹:

- **æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·**: ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰ç”¨æˆ·åŠå…¶è§’è‰²
- **æŸ¥çœ‹æ‰€æœ‰è§’è‰²**: å±•ç¤ºè§’è‰²åˆ—è¡¨åŠæƒé™æ•°é‡
- **æŸ¥çœ‹æ‰€æœ‰æƒé™**: å±•ç¤ºå®Œæ•´çš„æƒé™åˆ—è¡¨

#### 4. è§’è‰²-æƒé™å…³ç³»æµ‹è¯•

- å¯å±•å¼€æŸ¥çœ‹æ¯ä¸ªè§’è‰²çš„è¯¦ç»†ä¿¡æ¯
- æŒ‰åˆ†ç±»ç»„ç»‡æ˜¾ç¤ºè¯¥è§’è‰²æ‹¥æœ‰çš„æ‰€æœ‰æƒé™
- æ¸…æ™°å±•ç¤ºæƒé™çš„å±‚çº§å…³ç³»

#### 5. æƒé™æµ‹è¯•å·¥å…·

- è¾“å…¥ä»»æ„æƒé™æ ‡è¯†è¿›è¡Œæµ‹è¯•
- å®æ—¶åé¦ˆå½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è¯¥æƒé™
- æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æ‰€æœ‰æƒé™åˆ—è¡¨

---

### ä½¿ç”¨æŒ‡å—

#### é›†æˆåˆ°èœå•

åœ¨ `menu_pages/__init__.py` ä¸­æ·»åŠ :

```python
from .auth_test_page import auth_test_page_content

def get_menu_page_handlers():
    return {
        'home': home_content,
        'other_page': other_page_content,
        'chat_page': chat_page_content,
        'auth_test': auth_test_page_content,  # æ–°å¢
    }
```

#### æ·»åŠ åˆ°å¯¼èˆªèœå•

åœ¨ä¸»åº”ç”¨æ–‡ä»¶ä¸­æ·»åŠ èœå•é¡¹:

```python
MultilayerMenuItem(
    key='auth_test',
    label='è®¤è¯ç³»ç»Ÿæµ‹è¯•',
    icon='security',
    route='auth_test'
)
```

---

### æµ‹è¯•åœºæ™¯å»ºè®®

#### åœºæ™¯ 1: è¶…çº§ç®¡ç†å‘˜æµ‹è¯•

1. ä½¿ç”¨ `admin / admin123` ç™»å½•
2. è®¿é—®è®¤è¯æµ‹è¯•é¡µé¢
3. è§‚å¯Ÿæ‰€æœ‰æƒé™æ£€æŸ¥å‡æ˜¾ç¤º"âœ… æœ‰æƒé™"
4. æƒé™æµ‹è¯•å·¥å…·è¾“å…¥ä»»æ„æƒé™å‡è¿”å›æˆåŠŸ

#### åœºæ™¯ 2: æ™®é€šç”¨æˆ·æµ‹è¯•

1. ä½¿ç”¨ `user / user123` ç™»å½• (default åœºæ™¯)
2. è®¿é—®è®¤è¯æµ‹è¯•é¡µé¢
3. è§‚å¯Ÿåªæœ‰åŸºç¡€æƒé™æ˜¾ç¤º"âœ… æœ‰æƒé™"
4. ç³»ç»Ÿç®¡ç†ç›¸å…³æƒé™æ˜¾ç¤º"âŒ æ— æƒé™"

#### åœºæ™¯ 3: ç¼–è¾‘è€…æµ‹è¯•

1. ä½¿ç”¨ `editor / editor123` ç™»å½• (default åœºæ™¯)
2. è®¿é—®è®¤è¯æµ‹è¯•é¡µé¢
3. è§‚å¯Ÿå†…å®¹ç¼–è¾‘æƒé™æ˜¾ç¤º"âœ… æœ‰æƒé™"
4. ä½†ç³»ç»Ÿç®¡ç†æƒé™æ˜¾ç¤º"âŒ æ— æƒé™"

#### åœºæ™¯ 4: CMS åœºæ™¯æµ‹è¯•

1. åˆå§‹åŒ– CMS åœºæ™¯: `python scripts/init_database.py --scenario cms --test-data --reset`
2. ä½¿ç”¨ `chief / chief123` ç™»å½•
3. è§‚å¯Ÿä¸»ç¼–æ‹¥æœ‰æ–‡ç« å‘å¸ƒç­‰æƒé™
4. ä½¿ç”¨ `author / author123` ç™»å½•
5. è§‚å¯Ÿä½œè€…åªèƒ½åˆ›å»ºå’Œç¼–è¾‘,æ— æ³•å‘å¸ƒ

#### åœºæ™¯ 5: ERP åœºæ™¯æµ‹è¯•

1. åˆå§‹åŒ– ERP åœºæ™¯: `python scripts/init_database.py --scenario erp --test-data --reset`
2. ä½¿ç”¨ `finance / finance123` ç™»å½•
3. è§‚å¯Ÿè´¢åŠ¡ç»ç†æ‹¥æœ‰è´¢åŠ¡ç›¸å…³æƒé™
4. ä½†æ²¡æœ‰é‡‡è´­ã€é”€å”®ç­‰å…¶ä»–éƒ¨é—¨æƒé™

---

## ğŸ“Š æ•ˆæœå±•ç¤º

### é»˜è®¤åœºæ™¯æƒé™åˆ†é…è¡¨

| è§’è‰²   | ç³»ç»Ÿç®¡ç† | å†…å®¹åˆ›å»º | å†…å®¹ç¼–è¾‘ | å†…å®¹åˆ é™¤ | å†…å®¹æŸ¥çœ‹ |
| ------ | -------- | -------- | -------- | -------- | -------- |
| admin  | âœ…       | âœ…       | âœ…       | âœ…       | âœ…       |
| editor | âŒ       | âœ…       | âœ…       | âŒ       | âœ…       |
| user   | âŒ       | âŒ       | âŒ       | âŒ       | âœ…       |
| viewer | âŒ       | âŒ       | âŒ       | âŒ       | âœ…       |

### CMS åœºæ™¯æƒé™åˆ†é…è¡¨

| è§’è‰²         | åˆ›å»ºæ–‡ç«  | ç¼–è¾‘æ–‡ç«  | å‘å¸ƒæ–‡ç«  | åˆ é™¤æ–‡ç«  | å®¡æ ¸è¯„è®º |
| ------------ | -------- | -------- | -------- | -------- | -------- |
| editor_chief | âœ…       | âœ…       | âœ…       | âœ…       | âœ…       |
| author       | âœ…       | âœ…       | âŒ       | âŒ       | âœ…       |
| contributor  | âœ…       | âœ…       | âŒ       | âŒ       | âŒ       |
| reader       | âŒ       | âŒ       | âŒ       | âŒ       | âŒ       |

### ERP åœºæ™¯æƒé™åˆ†é…è¡¨

| è§’è‰²              | è´¢åŠ¡ç®¡ç† | é‡‡è´­ç®¡ç† | é”€å”®ç®¡ç† | åº“å­˜ç®¡ç† | æŠ¥è¡¨å¯¼å‡º |
| ----------------- | -------- | -------- | -------- | -------- | -------- |
| ceo               | âœ…       | âœ…       | âœ…       | âœ…       | âœ…       |
| finance_manager   | âœ…       | âŒ       | âŒ       | âŒ       | âœ…       |
| purchase_manager  | âŒ       | âœ…       | âŒ       | âœ…       | âœ…       |
| sales_manager     | âœ…       | âŒ       | âœ…       | âŒ       | âœ…       |
| warehouse_manager | âŒ       | âŒ       | âŒ       | âœ…       | âœ…       |

---

## ğŸ¨ æŠ€æœ¯ç‰¹ç‚¹

### 1. é¢å‘å¯¹è±¡è®¾è®¡

- ä½¿ç”¨åŸºç±» `ScenarioConfig` å®šä¹‰åœºæ™¯æ¥å£
- å„åœºæ™¯ç±»ç»§æ‰¿å¹¶å®ç°å…·ä½“é…ç½®
- æ˜“äºæ‰©å±•æ–°åœºæ™¯

### 2. é…ç½®ä¸ä»£ç åˆ†ç¦»

- è§’è‰²ã€æƒé™ã€æ˜ å°„å…³ç³»å‡åœ¨é…ç½®ç±»ä¸­å®šä¹‰
- åˆå§‹åŒ–é€»è¾‘ä¿æŒé€šç”¨
- ä¿®æ”¹åœºæ™¯æ— éœ€æ”¹åŠ¨æ ¸å¿ƒä»£ç 

### 3. å‘½ä»¤è¡Œå‹å¥½

- æ¸…æ™°çš„å‚æ•°è¯´æ˜
- è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯
- åœºæ™¯é€‰æ‹©å’ŒéªŒè¯

### 4. æµ‹è¯•é¡µé¢å®Œå–„

- å¤šç»´åº¦å±•ç¤ºæƒé™ä¿¡æ¯
- å®æ—¶æƒé™æ£€æŸ¥
- æ•°æ®åº“æ•°æ®å¯è§†åŒ–
- å…³ç³»æ˜ å°„æ¸…æ™°å±•ç¤º

### 5. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

- å¡ç‰‡å¼å¸ƒå±€æ¸…æ™°ç¾è§‚
- è¡¨æ ¼å±•ç¤ºæ•°æ®ç›´è§‚
- å¯å±•å¼€é¢æ¿èŠ‚çœç©ºé—´
- å®æ—¶åé¦ˆæµ‹è¯•ç»“æœ

---

## ğŸ”§ æ‰©å±•å»ºè®®

### æ·»åŠ æ–°åœºæ™¯

1. åˆ›å»ºæ–°çš„åœºæ™¯é…ç½®ç±»:

```python
class CustomScenario(ScenarioConfig):
    def __init__(self):
        super().__init__('custom', 'è‡ªå®šä¹‰åœºæ™¯æè¿°')
        self.roles = [...]
        self.permissions = [...]
        self.role_permissions = {...}
```

2. æ³¨å†Œåˆ°åœºæ™¯è¡¨:

```python
SCENARIOS = {
    'default': DefaultScenario(),
    'cms': CMSScenario(),
    'erp': ERPScenario(),
    'custom': CustomScenario(),  # æ–°å¢
}
```

3. æ›´æ–°å‘½ä»¤è¡Œå‚æ•°:

```python
parser.add_argument(
    '--scenario',
    choices=['default', 'cms', 'erp', 'custom'],  # æ·»åŠ  custom
    ...
)
```

### å¢å¼ºæµ‹è¯•é¡µé¢

å¯ä»¥æ·»åŠ ä»¥ä¸‹åŠŸèƒ½:

- ç”¨æˆ·åˆ‡æ¢è§’è‰²çš„æ¨¡æ‹ŸåŠŸèƒ½
- æƒé™ä¿®æ”¹çš„å®æ—¶é¢„è§ˆ
- è§’è‰²æƒé™çš„å¯è§†åŒ–å›¾è¡¨
- æƒé™å†²çªæ£€æµ‹å·¥å…·
- æ‰¹é‡æƒé™æµ‹è¯•

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“é‡ç½®**: ä½¿ç”¨ `--reset` å‚æ•°ä¼šåˆ é™¤æ‰€æœ‰ç°æœ‰æ•°æ®,è¯·è°¨æ…ä½¿ç”¨
2. **åœºæ™¯åˆ‡æ¢**: åˆ‡æ¢åœºæ™¯éœ€è¦é‡ç½®æ•°æ®åº“,å¦åˆ™ä¼šä¿ç•™æ—§åœºæ™¯çš„æ•°æ®
3. **æƒé™å‘½å**: å»ºè®®éµå¾ª `category.action` çš„å‘½åè§„èŒƒ
4. **æµ‹è¯•è´¦æˆ·**: æµ‹è¯•è´¦æˆ·å¯†ç å‡ä¸ºç®€å•å¯†ç ,ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹
5. **é¡µé¢æƒé™**: æµ‹è¯•é¡µé¢éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®

---

## âœ… ä»»åŠ¡å®Œæˆæ£€æŸ¥æ¸…å•

- [x] å®šä¹‰ä¸‰ç§åº”ç”¨åœºæ™¯é…ç½®
- [x] å®ç°åœºæ™¯é…ç½®åŸºç±»å’Œå­ç±»
- [x] æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ
- [x] ä¸ºæ¯ä¸ªåœºæ™¯åˆ›å»ºæµ‹è¯•è´¦æˆ·
- [x] åˆ›å»ºè®¤è¯æµ‹è¯•é¡µé¢
- [x] å®ç°å½“å‰ç”¨æˆ·ä¿¡æ¯å±•ç¤º
- [x] å®ç°æƒé™æ£€æŸ¥æµ‹è¯•åŠŸèƒ½
- [x] å®ç°æ•°æ®åº“æ•°æ®æŸ¥çœ‹åŠŸèƒ½
- [x] å®ç°è§’è‰²æƒé™å…³ç³»å±•ç¤º
- [x] å®ç°æƒé™æµ‹è¯•å·¥å…·
- [x] æ·»åŠ è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- [x] ç¼–å†™å®Œæ•´çš„æ–‡æ¡£è¯´æ˜

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿åé¦ˆ!

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-07
