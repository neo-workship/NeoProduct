<!DOCTYPE html>
<html>
<head>
<title>_README_COMPONENT.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="component-%E5%8C%85%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3">Component 包技术文档</h1>
<h2 id="1-%E6%95%B4%E4%BD%93%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%E4%B8%8E%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91">1. 整体设计思想与代码逻辑</h2>
<h3 id="11-%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5">1.1 设计理念</h3>
<p>Component 包是一个基于 NiceGUI 的 SPA（单页应用）布局管理框架，采用了以下核心设计理念：</p>
<ul>
<li><strong>分层架构</strong>：将布局配置、管理逻辑、静态资源管理分离，实现高内聚低耦合</li>
<li><strong>双布局模式</strong>：提供复杂布局（侧边栏+顶部导航）和简单布局（仅顶部导航）两种选择</li>
<li><strong>路由状态管理</strong>：实现 SPA 内部路由切换和状态持久化</li>
<li><strong>响应式设计</strong>：支持暗黑模式切换和自适应布局</li>
</ul>
<h3 id="12-%E8%B7%AF%E7%94%B1%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%E8%AF%A6%E8%A7%A3">1.2 路由设计思想详解</h3>
<p>Component 包的路由系统采用<strong>配置驱动</strong>的设计模式，整个路由流程可以分为以下几个核心环节：</p>
<h4 id="121-%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%E9%98%B6%E6%AE%B5">1.2.1 路由配置阶段</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 第一步：定义配置信息</span>
menu_items = [
    {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>},
    {<span class="hljs-string">'key'</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'仪表板'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'dashboard'</span>}
]

<span class="hljs-comment"># 第二步：关联路由处理函数</span>
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content,           <span class="hljs-comment"># route 'home' -&gt; 函数 home_page_content</span>
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content  <span class="hljs-comment"># route 'dashboard' -&gt; 函数 dashboard_page_content</span>
}
</div></code></pre>
<h4 id="122-%E7%BB%84%E4%BB%B6%E7%BB%91%E5%AE%9A%E9%98%B6%E6%AE%B5">1.2.2 组件绑定阶段</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># LayoutManager 在创建菜单时，将配置转换为 NiceGUI 组件</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_left_drawer</span><span class="hljs-params">(self)</span>:</span>
    <span class="hljs-keyword">for</span> menu_item <span class="hljs-keyword">in</span> self.menu_items:  <span class="hljs-comment"># 遍历配置的菜单项</span>
        <span class="hljs-keyword">with</span> ui.row().classes(<span class="hljs-string">'...'</span>) <span class="hljs-keyword">as</span> menu_row:
            ui.icon(menu_item.icon)    <span class="hljs-comment"># 使用配置的图标</span>
            ui.label(menu_item.label)  <span class="hljs-comment"># 使用配置的标签</span>

            <span class="hljs-comment"># 关键：绑定点击事件，传递配置信息</span>
            menu_row.on(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">lambda</span> key=menu_item.key, row=menu_row:
                        self.select_menu_item(key, row))  <span class="hljs-comment"># 回调函数携带配置的 key</span>
</div></code></pre>
<h4 id="123-%E4%BA%8B%E4%BB%B6%E5%9B%9E%E8%B0%83%E9%98%B6%E6%AE%B5">1.2.3 事件回调阶段</h4>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">select_menu_item</span><span class="hljs-params">(self, key: str, row_element=None, update_storage: bool = True)</span>:</span>
    <span class="hljs-string">"""点击菜单项的回调函数"""</span>
    <span class="hljs-comment"># 第一步：根据 key 找到对应的配置项</span>
    menu_item = next((item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.menu_items <span class="hljs-keyword">if</span> item.key == key), <span class="hljs-literal">None</span>)

    <span class="hljs-comment"># 第二步：从配置项中获取路由信息</span>
    <span class="hljs-keyword">if</span> menu_item <span class="hljs-keyword">and</span> menu_item.route:
        <span class="hljs-comment"># 第三步：调用路由导航，传递配置中的路由名</span>
        self.navigate_to_route(menu_item.route, menu_item.label, update_storage)
</div></code></pre>
<h4 id="124-%E8%B7%AF%E7%94%B1%E6%89%A7%E8%A1%8C%E9%98%B6%E6%AE%B5">1.2.4 路由执行阶段</h4>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">navigate_to_route</span><span class="hljs-params">(self, route: str, label: str, update_storage: bool = True)</span>:</span>
    <span class="hljs-string">"""执行路由跳转"""</span>
    <span class="hljs-comment"># 第一步：在路由处理器字典中查找对应函数</span>
    <span class="hljs-keyword">if</span> route <span class="hljs-keyword">in</span> self.route_handlers:
        handler_function = self.route_handlers[route]  <span class="hljs-comment"># 获取配置的处理函数</span>

        <span class="hljs-comment"># 第二步：清空内容容器</span>
        self.content_container.clear()

        <span class="hljs-comment"># 第三步：执行路由处理函数</span>
        <span class="hljs-keyword">with</span> self.content_container:
            handler_function()  <span class="hljs-comment"># 调用配置中关联的函数（如 home_page_content）</span>
</div></code></pre>
<h4 id="125-%E4%B8%8D%E5%90%8C%E7%BB%84%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F">1.2.5 不同组件类型的绑定方式</h4>
<p><strong>A. 侧边栏菜单组件绑定</strong>（复杂布局）</p>
<pre class="hljs"><code><div><span class="hljs-comment"># layout_manager.py - create_left_drawer()</span>
<span class="hljs-keyword">for</span> menu_item <span class="hljs-keyword">in</span> self.menu_items:
    <span class="hljs-keyword">with</span> ui.row().classes(<span class="hljs-string">'...'</span>) <span class="hljs-keyword">as</span> menu_row:
        ui.icon(menu_item.icon)
        ui.label(menu_item.label)

        <span class="hljs-comment"># 绑定点击事件：row.on() -&gt; select_menu_item()</span>
        menu_row.on(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">lambda</span> key=menu_item.key, row=menu_row:
                    self.select_menu_item(key, row))
</div></code></pre>
<p><strong>B. 顶部导航按钮绑定</strong>（简单布局）</p>
<pre class="hljs"><code><div><span class="hljs-comment"># simple_layout_manager.py - create_header()</span>
<span class="hljs-keyword">for</span> nav_item <span class="hljs-keyword">in</span> self.nav_items:
    nav_btn = ui.button(
        nav_item.label,
        icon=nav_item.icon,
        <span class="hljs-comment"># 绑定点击事件：button.on_click -&gt; select_nav_item()</span>
        on_click=<span class="hljs-keyword">lambda</span> key=nav_item.key: self.select_nav_item(key)
    )
</div></code></pre>
<p><strong>C. 头部功能按钮绑定</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment"># layout_manager.py - create_header()</span>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.header_config_items:
    ui.button(
        item.label,
        icon=item.icon,
        <span class="hljs-comment"># 绑定点击事件：button.on_click -&gt; handle_header_config_item_click()</span>
        on_click=<span class="hljs-keyword">lambda</span> current_item=item: self.handle_header_config_item_click(current_item)
    )
</div></code></pre>
<p><strong>D. 下拉菜单项绑定</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment"># layout_manager.py - create_header()</span>
<span class="hljs-keyword">with</span> ui.menu() <span class="hljs-keyword">as</span> settings_menu:
    <span class="hljs-comment"># 绑定点击事件：menu_item -&gt; handle_settings_menu_item_click()</span>
    ui.menu_item(<span class="hljs-string">'用户管理'</span>,
                <span class="hljs-keyword">lambda</span>: self.handle_settings_menu_item_click(<span class="hljs-string">'user_management'</span>, <span class="hljs-string">'用户管理'</span>))
</div></code></pre>
<h4 id="126-%E5%AE%8C%E6%95%B4%E8%B7%AF%E7%94%B1%E6%B5%81%E7%A8%8B%E5%9B%BE">1.2.6 完整路由流程图</h4>
<pre class="hljs"><code><div>配置阶段          组件绑定阶段         事件触发阶段         路由执行阶段
┌─────────┐      ┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│menu_items│ ──→  │ui.row.on()  │ ──→  │select_menu_ │ ──→  │navigate_to_ │
│配置信息  │      │绑定click事件│      │item(key)    │      │route(route) │
└─────────┘      └─────────────┘      └─────────────┘      └─────────────┘
     │                   │                    │                    │
     ├─ key: 'home'      ├─ 传递: key        ├─ 查找: menu_item   ├─ 查找: handler
     ├─ label: '首页'     ├─ 回调函数携带     ├─ 获取: route       ├─ 执行: function()
     ├─ icon: 'home'     │   配置key         ├─ 调用: navigate    └─ 渲染: 页面内容
     └─ route: 'home'    └─ lambda传递参数   └─ 传递: route名称

┌────────────────────────────────────────────────────────────────────────────┐
│                           Lambda 闭包机制详解                               │
├────────────────────────────────────────────────────────────────────────────┤
│ # 问题：为什么要使用 lambda key=menu_item.key ?                            │
│                                                                            │
│ # ❌ 错误写法：                                                            │
│ for menu_item in self.menu_items:                                         │
│     menu_row.on('click', lambda: self.select_menu_item(menu_item.key))    │
│ # 问题：所有 lambda 都会引用最后一个 menu_item.key                          │
│                                                                            │
│ # ✅ 正确写法：                                                            │
│ for menu_item in self.menu_items:                                         │
│     menu_row.on('click', lambda key=menu_item.key:                        │
│                         self.select_menu_item(key))                       │
│ # 原理：key=menu_item.key 创建了闭包，捕获当前循环的值                      │
└────────────────────────────────────────────────────────────────────────────┘
</div></code></pre>
<h4 id="127-%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E7%9A%84%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6">1.2.7 路由配置与处理函数的映射机制</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 配置 -&gt; 组件 -&gt; 回调 -&gt; 路由 -&gt; 函数 的完整链路</span>

Step <span class="hljs-number">1</span>: 配置定义
menu_items = [
    {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'home'</span>}
]
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content  <span class="hljs-comment"># 路由名 -&gt; 处理函数</span>
}

Step <span class="hljs-number">2</span>: 组件创建与绑定
menu_row.on(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">lambda</span> key=<span class="hljs-string">'home'</span>: self.select_menu_item(<span class="hljs-string">'home'</span>))

Step <span class="hljs-number">3</span>: 事件回调处理
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">select_menu_item</span><span class="hljs-params">(self, key)</span>:</span>
    menu_item = find_by_key(key)      <span class="hljs-comment"># 通过 key 找到配置项</span>
    route = menu_item.route           <span class="hljs-comment"># 从配置项获取 route = 'home'</span>
    self.navigate_to_route(route)     <span class="hljs-comment"># 传递 route 给导航函数</span>

Step <span class="hljs-number">4</span>: 路由执行
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">navigate_to_route</span><span class="hljs-params">(self, route)</span>:</span>
    handler = self.route_handlers[route]  <span class="hljs-comment"># route='home' -&gt; home_page_content</span>
    handler()                             <span class="hljs-comment"># 执行 home_page_content()</span>
</div></code></pre>
<h3 id="13-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E7%BB%84%E4%BB%B6">1.3 核心架构组件</h3>
<pre class="hljs"><code><div>component/
├── layout_config.py        # 布局配置类，定义菜单项、头部配置等
├── layout_manager.py       # 复杂布局管理器（侧边栏+顶部）
├── simple_layout_manager.py # 简单布局管理器（仅顶部导航）
├── spa_layout.py           # 复杂布局装饰器和工具函数
├── simple_spa_layout.py    # 简单布局装饰器和工具函数
└── static_resources.py     # 静态资源管理器
</div></code></pre>
<h3 id="14-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">1.4 设计模式</h3>
<ul>
<li><strong>装饰器模式</strong>：<code>@with_spa_layout</code> 和 <code>@with_simple_spa_layout</code> 提供声明式布局配置</li>
<li><strong>管理器模式</strong>：LayoutManager 和 SimpleLayoutManager 封装布局管理逻辑</li>
<li><strong>单例模式</strong>：全局静态资源管理器和布局管理器实例</li>
<li><strong>配置模式</strong>：通过 LayoutConfig 集中管理布局配置</li>
</ul>
<h2 id="2-%E5%8C%85%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%B8%83%E5%B1%80%E6%A0%B7%E5%BC%8F">2. 包的作用与布局样式</h2>
<h3 id="21-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD">2.1 核心功能</h3>
<p>Component 包提供以下核心功能：</p>
<ol>
<li><strong>SPA 路由管理</strong>：实现页面内路由切换，无需刷新页面</li>
<li><strong>布局组件化</strong>：提供可复用的布局组件和配置</li>
<li><strong>状态持久化</strong>：支持页面刷新后恢复用户的导航状态</li>
<li><strong>静态资源管理</strong>：统一管理 CSS、图片、字体等静态资源</li>
<li><strong>响应式支持</strong>：内置暗黑模式和主题切换功能</li>
</ol>
<h3 id="22-%E6%94%AF%E6%8C%81%E7%9A%84%E5%B8%83%E5%B1%80%E6%A0%B7%E5%BC%8F">2.2 支持的布局样式</h3>
<h4 id="221-%E5%A4%8D%E6%9D%82%E5%B8%83%E5%B1%80layoutmanager">2.2.1 复杂布局（LayoutManager）</h4>
<pre class="hljs"><code><div>┌─────────────────────────────────────────────────────────────┐
│ Header: Logo + Title │ Nav Items │ Theme │ Settings │ User │
├─────────────┬───────────────────────────────────────────────┤
│ Left Drawer │                                               │
│ ┌─────────┐ │                                               │
│ │ Menu 1  │ │                                               │
│ │ Menu 2  │ │            Content Area                       │
│ │ ──────  │ │                                               │
│ │ Menu 3  │ │                                               │
│ │ Menu 4  │ │                                               │
│ └─────────┘ │                                               │
└─────────────┴───────────────────────────────────────────────┘
</div></code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>左侧可折叠抽屉式菜单</li>
<li>适合功能模块较多的复杂应用</li>
<li>支持菜单分组和分隔符</li>
</ul>
<h4 id="222-%E7%AE%80%E5%8D%95%E5%B8%83%E5%B1%80simplelayoutmanager">2.2.2 简单布局（SimpleLayoutManager）</h4>
<pre class="hljs"><code><div>┌─────────────────────────────────────────────────────────────┐
│ Header: Logo │ Nav1 │ Nav2 │ Nav3 │ Theme │ Settings │ User │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                                                             │
│                    Content Area                             │
│                                                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</div></code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>顶部水平导航栏</li>
<li>适合功能模块较少的简洁应用</li>
<li>更多内容展示空间</li>
</ul>
<h2 id="3-%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4">3. 使用操作步骤</h2>
<h3 id="31-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B">3.1 基础使用流程</h3>
<h4 id="%E6%AD%A5%E9%AA%A4-1%E9%85%8D%E7%BD%AE%E5%B8%83%E5%B1%80">步骤 1：配置布局</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> component <span class="hljs-keyword">import</span> LayoutConfig

<span class="hljs-comment"># 创建自定义配置</span>
config = LayoutConfig()
config.app_title = <span class="hljs-string">'我的应用'</span>
config.app_icon = <span class="hljs-string">'/static/images/logo/my-logo.svg'</span>
</div></code></pre>
<h4 id="%E6%AD%A5%E9%AA%A4-2%E5%87%86%E5%A4%87%E9%A1%B5%E9%9D%A2%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0">步骤 2：准备页面处理函数</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># menu_pages/__init__.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_menu_page_handlers</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'home'</span>: home_page_content,
        <span class="hljs-string">'dashboard'</span>: dashboard_page_content,
        <span class="hljs-string">'analysis'</span>: analysis_page_content,
    }

<span class="hljs-comment"># header_pages/__init__.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_header_page_handlers</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'search_page'</span>: search_page_content,
        <span class="hljs-string">'messages_page'</span>: messages_page_content,
    }
</div></code></pre>
<h4 id="%E6%AD%A5%E9%AA%A4-3%E4%BD%BF%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8%E5%88%9B%E5%BB%BA%E5%B8%83%E5%B1%80">步骤 3：使用装饰器创建布局</h4>
<h5 id="311-%E5%A4%8D%E6%9D%82%E5%B8%83%E5%B1%80%E7%A4%BA%E4%BE%8B">3.1.1 复杂布局示例</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> component <span class="hljs-keyword">import</span> with_spa_layout

<span class="hljs-meta">@with_spa_layout(</span>
    config=config,
    menu_items=[
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>},
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'仪表板'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'dashboard'</span>},
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'analysis'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'分析'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'analytics'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'analysis'</span>},
    ],
    header_config_items=[
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'search'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'search'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'search_page'</span>},
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'messages'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'mail'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'messages_page'</span>},
    ],
    route_handlers={
        **get_menu_page_handlers(),
        **get_header_page_handlers(),
    }
)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main_page</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">pass</span>
</div></code></pre>
<h5 id="312-%E7%AE%80%E5%8D%95%E5%B8%83%E5%B1%80%E7%A4%BA%E4%BE%8B">3.1.2 简单布局示例</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> component <span class="hljs-keyword">import</span> with_simple_spa_layout

<span class="hljs-meta">@with_simple_spa_layout(</span>
    config=config,
    nav_items=[  <span class="hljs-comment"># 注意：简单布局使用 nav_items 而不是 menu_items</span>
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>},
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'products'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'产品'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'inventory'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'products'</span>},
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'about'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'关于'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'info'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'about'</span>},
    ],
    route_handlers=get_menu_page_handlers()
)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">simple_app</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">pass</span>
</div></code></pre>
<h3 id="32-%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E">3.2 核心函数使用说明</h3>
<h4 id="321-%E5%B8%83%E5%B1%80%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0">3.2.1 布局创建函数</h4>
<table>
<thead>
<tr>
<th>函数名</th>
<th>用途</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>with_spa_layout()</code></td>
<td>复杂布局装饰器</td>
<td>config, menu_items, header_config_items, route_handlers</td>
</tr>
<tr>
<td><code>with_simple_spa_layout()</code></td>
<td>简单布局装饰器</td>
<td>config, nav_items, header_config_items, route_handlers</td>
</tr>
<tr>
<td><code>create_spa_layout()</code></td>
<td>直接创建复杂布局</td>
<td>同装饰器参数</td>
</tr>
<tr>
<td><code>create_simple_spa_layout()</code></td>
<td>直接创建简单布局</td>
<td>同装饰器参数</td>
</tr>
</tbody>
</table>
<h4 id="322-%E5%AF%BC%E8%88%AA%E5%87%BD%E6%95%B0">3.2.2 导航函数</h4>
<table>
<thead>
<tr>
<th>函数名</th>
<th>用途</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>navigate_to(route, label)</code></td>
<td>复杂布局导航</td>
<td>route: 路由名, label: 显示标签</td>
</tr>
<tr>
<td><code>simple_navigate_to(route, label)</code></td>
<td>简单布局导航</td>
<td>route: 路由名, label: 显示标签</td>
</tr>
</tbody>
</table>
<h4 id="323-%E8%B7%AF%E7%94%B1%E6%B3%A8%E5%86%8C%E5%87%BD%E6%95%B0">3.2.3 路由注册函数</h4>
<table>
<thead>
<tr>
<th>函数名</th>
<th>用途</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>register_route_handler(route, handler)</code></td>
<td>复杂布局路由注册</td>
<td>route: 路由名, handler: 处理函数</td>
</tr>
<tr>
<td><code>register_simple_route_handler(route, handler)</code></td>
<td>简单布局路由注册</td>
<td>route: 路由名, handler: 处理函数</td>
</tr>
</tbody>
</table>
<h3 id="33-%E4%B8%8E%E5%85%B6%E4%BB%96%E5%8C%85%E7%9A%84%E5%85%B3%E8%81%94">3.3 与其他包的关联</h3>
<h4 id="331-%E9%A1%B5%E9%9D%A2%E5%8C%85%E7%9A%84%E7%BB%84%E7%BB%87%E8%A7%84%E8%8C%83">3.3.1 页面包的组织规范</h4>
<p><strong>menu_pages 包结构</strong>（左侧菜单或顶部导航对应的页面）：</p>
<pre class="hljs"><code><div>menu_pages/
├── __init__.py              <span class="hljs-comment"># 导出 get_menu_page_handlers()</span>
├── home_page.py             <span class="hljs-comment"># 首页内容</span>
├── dashboard_page.py        <span class="hljs-comment"># 仪表板页面</span>
├── analysis_page.py         <span class="hljs-comment"># 分析页面</span>
└── about_page.py           <span class="hljs-comment"># 关于页面</span>

<span class="hljs-comment"># __init__.py 必须包含：</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_menu_page_handlers</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'home'</span>: home_page_content,
        <span class="hljs-string">'dashboard'</span>: dashboard_page_content,
        <span class="hljs-string">'analysis'</span>: analysis_page_content,
        <span class="hljs-string">'about'</span>: about_page_content
    }
</div></code></pre>
<p><strong>header_pages 包结构</strong>（头部功能对应的页面）：</p>
<pre class="hljs"><code><div>header_pages/
├── __init__.py              <span class="hljs-comment"># 导出 get_header_page_handlers()</span>
├── search_page.py           <span class="hljs-comment"># 搜索页面</span>
├── messages_page.py         <span class="hljs-comment"># 消息页面</span>
└── contact_page.py         <span class="hljs-comment"># 联系页面</span>

<span class="hljs-comment"># __init__.py 必须包含：</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_header_page_handlers</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'search_page'</span>: search_page_content,
        <span class="hljs-string">'messages_page'</span>: messages_page_content,
        <span class="hljs-string">'contact_page'</span>: contact_page_content,
    }
</div></code></pre>
<h4 id="332-%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB">3.3.2 路由映射关系</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 配置中的路由名与页面处理函数的映射关系</span>
route_handlers = {
    <span class="hljs-comment"># menu_items 中的 route 对应 menu_pages 中的函数</span>
    <span class="hljs-string">'home'</span>: home_page_content,           <span class="hljs-comment"># menu_pages/home_page.py</span>
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content,  <span class="hljs-comment"># menu_pages/dashboard_page.py</span>

    <span class="hljs-comment"># header_config_items 中的 route 对应 header_pages 中的函数</span>
    <span class="hljs-string">'search_page'</span>: search_page_content,  <span class="hljs-comment"># header_pages/search_page.py</span>
    <span class="hljs-string">'messages_page'</span>: messages_page_content, <span class="hljs-comment"># header_pages/messages_page.py</span>

    <span class="hljs-comment"># 系统路由（由 auth 包提供）</span>
    <span class="hljs-string">'login'</span>: login_page_content,
    <span class="hljs-string">'user_profile'</span>: profile_page_content,
}
</div></code></pre>
<h3 id="34-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86">3.4 静态资源管理</h3>
<h4 id="341-%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">3.4.1 资源目录结构</h4>
<pre class="hljs"><code><div>static/
├── images/
│   ├── logo/                # Logo 图片
│   ├── avatars/            # 用户头像
│   └── icons/              # 图标资源
├── css/
│   ├── custom.css          # 自定义样式
│   └── themes/             # 主题样式
│       ├── light.css
│       └── dark.css
├── js/                     # JavaScript 文件
└── fonts/                  # 字体文件
</div></code></pre>
<h4 id="342-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8">3.4.2 静态资源使用</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> component <span class="hljs-keyword">import</span> static_manager

<span class="hljs-comment"># 获取资源路径</span>
logo_path = static_manager.get_logo_path(<span class="hljs-string">'my-logo.svg'</span>)
css_url = static_manager.get_css_path(<span class="hljs-string">'custom.css'</span>)
avatar_path = static_manager.get_avatar_path(<span class="hljs-string">'user1.png'</span>)

<span class="hljs-comment"># 加载 CSS 文件</span>
static_manager.load_css_files()  <span class="hljs-comment"># 自动加载所有 CSS</span>

<span class="hljs-comment"># 检查文件是否存在</span>
<span class="hljs-keyword">if</span> static_manager.file_exists(logo_path):
    <span class="hljs-comment"># 使用 Logo</span>
    <span class="hljs-keyword">pass</span>
</div></code></pre>
<h2 id="4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">4. 注意事项与最佳实践</h2>
<h3 id="41-%E9%87%8D%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">4.1 重要注意事项</h3>
<h4 id="411-%E8%B7%AF%E7%94%B1%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6">4.1.1 路由持久化机制</h4>
<ul>
<li><strong>持久化路由</strong>：普通页面路由会保存到 <code>app.storage.user['current_route']</code>，页面刷新后自动恢复</li>
<li><strong>非持久化路由</strong>：<code>logout</code>、<code>login</code>、<code>register</code> 等一次性操作路由不会被持久化</li>
<li><strong>路由恢复优先级</strong>：保存的路由 → 第一个菜单项 → 空白状态</li>
</ul>
<h4 id="412-%E5%B8%83%E5%B1%80%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE">4.1.2 布局选择建议</h4>
<table>
<thead>
<tr>
<th>应用类型</th>
<th>推荐布局</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td>管理后台</td>
<td>复杂布局</td>
<td>功能模块多，需要清晰的层级结构</td>
</tr>
<tr>
<td>企业官网</td>
<td>简单布局</td>
<td>页面较少，注重内容展示</td>
</tr>
<tr>
<td>工具应用</td>
<td>简单布局</td>
<td>操作简单，界面简洁</td>
</tr>
<tr>
<td>数据分析平台</td>
<td>复杂布局</td>
<td>功能复杂，需要分类组织</td>
</tr>
</tbody>
</table>
<h4 id="413-%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83">4.1.3 命名规范</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 路由命名：使用下划线连接的小写字母</span>
<span class="hljs-string">'user_management'</span>  <span class="hljs-comment"># ✅ 正确</span>
<span class="hljs-string">'userManagement'</span>   <span class="hljs-comment"># ❌ 错误</span>
<span class="hljs-string">'User-Management'</span>  <span class="hljs-comment"># ❌ 错误</span>

<span class="hljs-comment"># 页面函数命名：以 _content 结尾</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home_page_content</span><span class="hljs-params">()</span>:</span>        <span class="hljs-comment"># ✅ 正确</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home_page</span><span class="hljs-params">()</span>:</span>               <span class="hljs-comment"># ❌ 错误</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home_content</span><span class="hljs-params">()</span>:</span>            <span class="hljs-comment"># ❌ 错误</span>

<span class="hljs-comment"># 键名命名：简洁明了</span>
{<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, ...}           <span class="hljs-comment"># ✅ 正确</span>
{<span class="hljs-string">'key'</span>: <span class="hljs-string">'home_page'</span>, ...}      <span class="hljs-comment"># ❌ 冗余</span>
</div></code></pre>
<h3 id="42-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">4.2 最佳实践</h3>
<h4 id="421-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91">4.2.1 模块化开发</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 推荐：分离配置和逻辑</span>
<span class="hljs-comment"># config/layout_config.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_app_config</span><span class="hljs-params">()</span>:</span>
    config = LayoutConfig()
    config.app_title = <span class="hljs-string">'我的应用'</span>
    <span class="hljs-keyword">return</span> config

<span class="hljs-comment"># config/menu_config.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_menu_items</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> [
        {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>},
        <span class="hljs-comment"># ...</span>
    ]

<span class="hljs-comment"># main.py</span>
<span class="hljs-keyword">from</span> config.layout_config <span class="hljs-keyword">import</span> get_app_config
<span class="hljs-keyword">from</span> config.menu_config <span class="hljs-keyword">import</span> get_menu_items

<span class="hljs-meta">@with_spa_layout(</span>
    config=get_app_config(),
    menu_items=get_menu_items(),
    route_handlers=get_all_handlers()
)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main_page</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">pass</span>
</div></code></pre>
<h4 id="422-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">4.2.2 错误处理</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 推荐：为页面内容添加错误处理</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_page_content</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 页面逻辑</span>
        ui.label(<span class="hljs-string">'页面内容'</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        ui.label(<span class="hljs-string">f'页面加载失败: <span class="hljs-subst">{str(e)}</span>'</span>).classes(<span class="hljs-string">'text-red-500'</span>)
        print(<span class="hljs-string">f'页面错误: <span class="hljs-subst">{e}</span>'</span>)

<span class="hljs-comment"># ✅ 推荐：检查路由处理器是否存在</span>
route_handlers = get_menu_page_handlers()
<span class="hljs-keyword">if</span> <span class="hljs-string">'home'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> route_handlers:
    print(<span class="hljs-string">'警告：缺少 home 路由处理器'</span>)
</div></code></pre>
<h4 id="423-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">4.2.3 性能优化</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 推荐：延迟加载大型组件</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">analysis_page_content</span><span class="hljs-params">()</span>:</span>
    ui.label(<span class="hljs-string">'分析页面'</span>)

    <span class="hljs-comment"># 使用 timer 延迟加载复杂图表</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_charts</span><span class="hljs-params">()</span>:</span>
        <span class="hljs-comment"># 加载图表逻辑</span>
        <span class="hljs-keyword">pass</span>

    ui.timer(<span class="hljs-number">0.1</span>, load_charts, once=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># ✅ 推荐：条件加载 CSS</span>
<span class="hljs-keyword">if</span> static_manager.file_exists(<span class="hljs-string">'css/custom.css'</span>):
    static_manager.load_css_files()
</div></code></pre>
<h4 id="424-%E4%B8%BB%E9%A2%98%E5%AE%9A%E5%88%B6">4.2.4 主题定制</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 推荐：自定义主题配置</span>
config = LayoutConfig()
config.header_bg = <span class="hljs-string">'bg-blue-600 dark:bg-blue-800'</span>
config.drawer_bg = <span class="hljs-string">'bg-gray-100 dark:bg-gray-700'</span>
config.drawer_width = <span class="hljs-string">'w-72'</span>  <span class="hljs-comment"># 更宽的侧边栏</span>

<span class="hljs-comment"># ✅ 推荐：响应式图标</span>
menu_items = [
    {
        <span class="hljs-string">'key'</span>: <span class="hljs-string">'dashboard'</span>,
        <span class="hljs-string">'label'</span>: <span class="hljs-string">'仪表板'</span>,
        <span class="hljs-string">'icon'</span>: <span class="hljs-string">'dashboard'</span>,  <span class="hljs-comment"># Material Icons</span>
        <span class="hljs-string">'route'</span>: <span class="hljs-string">'dashboard'</span>
    },
    {
        <span class="hljs-string">'key'</span>: <span class="hljs-string">'custom'</span>,
        <span class="hljs-string">'label'</span>: <span class="hljs-string">'自定义'</span>,
        <span class="hljs-string">'icon'</span>: <span class="hljs-string">'custom_icon'</span>,
        <span class="hljs-string">'route'</span>: <span class="hljs-string">'custom'</span>,
        <span class="hljs-string">'custom_icon_path'</span>: <span class="hljs-string">'/static/icons/custom.svg'</span>  <span class="hljs-comment"># 自定义图标</span>
    }
]
</div></code></pre>
<h3 id="43-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">4.3 常见问题解决</h3>
<h4 id="431-%E8%B7%AF%E7%94%B1%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE">4.3.1 路由无法访问</h4>
<p><strong>问题</strong>：点击菜单项后页面显示&quot;页面未找到&quot;</p>
<p><strong>解决</strong>：检查路由处理器是否正确注册</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查路由名是否匹配</span>
menu_items = [
    {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>}  <span class="hljs-comment"># route 名称</span>
]

route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content  <span class="hljs-comment"># 必须匹配 route 名称</span>
}
</div></code></pre>
<h4 id="432-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%A4%B1%E8%B4%A5">4.3.2 静态资源加载失败</h4>
<p><strong>问题</strong>：CSS 或图片无法加载</p>
<p><strong>解决</strong>：检查文件路径和权限</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查文件是否存在</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> static_manager.file_exists(<span class="hljs-string">'css/custom.css'</span>):
    print(<span class="hljs-string">'CSS 文件不存在，请检查路径'</span>)

<span class="hljs-comment"># 确保静态目录权限正确</span>
static_manager._ensure_directories()
</div></code></pre>
<h4 id="433-%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E5%90%8E%E7%8A%B6%E6%80%81%E4%B8%A2%E5%A4%B1">4.3.3 页面刷新后状态丢失</h4>
<p><strong>问题</strong>：刷新页面后回到首页</p>
<p><strong>解决</strong>：确保路由持久化正常工作</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查存储是否可用</span>
<span class="hljs-keyword">try</span>:
    app.storage.user[<span class="hljs-string">'test'</span>] = <span class="hljs-string">'value'</span>
    print(<span class="hljs-string">'存储正常'</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    print(<span class="hljs-string">f'存储异常: <span class="hljs-subst">{e}</span>'</span>)

<span class="hljs-comment"># 确保 storage_secret 已设置</span>
ui.run(storage_secret=<span class="hljs-string">'your-secret-key'</span>)
</div></code></pre>
<hr>
<h2 id="5-%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7">5. 版本兼容性</h2>
<p>当前版本：v1.0.0-beta</p>
<p><strong>依赖要求</strong>：</p>
<ul>
<li>NiceGUI &gt;= 1.4.0</li>
<li>Python &gt;= 3.8</li>
</ul>
<p><strong>更新计划</strong>：</p>
<ul>
<li><input type="checkbox" id="checkbox0"><label for="checkbox0">支持自定义布局模板</label></li>
<li><input type="checkbox" id="checkbox1"><label for="checkbox1">添加动画过渡效果</label></li>
<li><input type="checkbox" id="checkbox2"><label for="checkbox2">支持多级菜单</label></li>
<li><input type="checkbox" id="checkbox3"><label for="checkbox3">移动端适配优化</label></li>
</ul>
<hr>
<p><em>本文档将随着框架的更新持续完善，如有疑问请参考示例代码或提交 Issue。</em></p>
<h1 id="python-%E7%9F%A5%E8%AF%86%E7%82%B9">python 知识点</h1>
<ul>
<li>问题起点</li>
</ul>
<pre class="hljs"><code><div>类似这样的语句：self.route_handlers[route]() ，最后就解析为路由函数了，感觉就是名字的拼接xxxx().这就是脚本语言的优势吗，这样也能被正确的调用执行。
 if route in self.route_handlers:
            print(f&quot;✅ 执行路由处理器: {route}&quot;)
            with self.content_container:
                try:
                    self.route_handlers[route]()
                except Exception as e:
                    print(f&quot;❌ 路由处理器执行失败 {route}: {e}&quot;)
                    ui.label(f'页面加载失败: {str(e)}').classes('text-red-500 text-xl')
</div></code></pre>
<h1 id="python-%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7%E5%88%86%E6%9E%90---%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">Python 动态语言特性分析 - 路由系统实现原理</h1>
<h2 id="1-%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80%E7%9A%84%E6%9C%AC%E8%B4%A8%E7%89%B9%E6%80%A7">1. 动态语言的本质特性</h2>
<h3 id="11-%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E7%AC%AC%E4%B8%80%E7%B1%BB%E5%AF%B9%E8%B1%A1first-class-objects">1.1 函数作为第一类对象（First-Class Objects）</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 在 Python 中，函数是"第一类对象"，可以像变量一样被操作</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home_page_content</span><span class="hljs-params">()</span>:</span>
    print(<span class="hljs-string">"首页内容"</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dashboard_page_content</span><span class="hljs-params">()</span>:</span>
    print(<span class="hljs-string">"仪表板内容"</span>)

<span class="hljs-comment"># 函数可以被赋值给变量</span>
my_function = home_page_content
my_function()  <span class="hljs-comment"># 输出: 首页内容</span>

<span class="hljs-comment"># 函数可以存储在数据结构中</span>
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content,        <span class="hljs-comment"># 存储函数对象（不是字符串！）</span>
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content
}

<span class="hljs-comment"># 函数可以通过变量名动态调用</span>
route = <span class="hljs-string">'home'</span>
handler = route_handlers[route]  <span class="hljs-comment"># handler 现在指向 home_page_content 函数</span>
handler()  <span class="hljs-comment"># 等价于 home_page_content()</span>
</div></code></pre>
<h3 id="12-%E4%B8%8E%E9%9D%99%E6%80%81%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AF%B9%E6%AF%94">1.2 与静态语言的对比</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Python (动态语言) - 运行时解析</span>
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content,     <span class="hljs-comment"># 存储的是函数对象的引用</span>
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content
}
route_handlers[<span class="hljs-string">'home'</span>]()  <span class="hljs-comment"># 运行时查找并调用</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">// Java (静态语言) - 需要反射或设计模式</span>
Map&lt;String, Runnable&gt; handlers = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
handlers.put(<span class="hljs-string">"home"</span>, () -&gt; homePageContent());
handlers.get(<span class="hljs-string">"home"</span>).run();

<span class="hljs-comment">// 或者使用反射 (性能较差)</span>
Method method = <span class="hljs-keyword">this</span>.getClass().getMethod(<span class="hljs-string">"homePageContent"</span>);
method.invoke(<span class="hljs-keyword">this</span>);
</div></code></pre>
<h2 id="2-python-%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F">2. Python 动态调用的多种方式</h2>
<h3 id="21-%E5%AD%97%E5%85%B8%E6%98%A0%E5%B0%84%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E6%96%B9%E5%BC%8F">2.1 字典映射（当前使用的方式）</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 最直观、性能最好的方式</span>
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content,
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content
}
route_handlers[route]()  <span class="hljs-comment"># 直接调用函数对象</span>
</div></code></pre>
<h3 id="22-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5--eval%E4%B8%8D%E6%8E%A8%E8%8D%90">2.2 字符串拼接 + eval（不推荐）</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># ❌ 危险且性能差的方式</span>
route = <span class="hljs-string">'home'</span>
function_name = <span class="hljs-string">f"<span class="hljs-subst">{route}</span>_page_content"</span>  <span class="hljs-comment"># 'home_page_content'</span>
eval(<span class="hljs-string">f"<span class="hljs-subst">{function_name}</span>()"</span>)  <span class="hljs-comment"># 字符串拼接后执行</span>
</div></code></pre>
<h3 id="23-getattr-%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E5%B8%B8%E7%94%A8%E4%BA%8E%E7%B1%BB%E6%96%B9%E6%B3%95">2.3 getattr 动态获取（常用于类方法）</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 适用于类方法的动态调用</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageHandler</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home_page_content</span><span class="hljs-params">(self)</span>:</span>
        print(<span class="hljs-string">"首页"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dashboard_page_content</span><span class="hljs-params">(self)</span>:</span>
        print(<span class="hljs-string">"仪表板"</span>)

handler = PageHandler()
route = <span class="hljs-string">'home'</span>
method_name = <span class="hljs-string">f"<span class="hljs-subst">{route}</span>_page_content"</span>
method = getattr(handler, method_name)  <span class="hljs-comment"># 动态获取方法</span>
method()  <span class="hljs-comment"># 调用方法</span>
</div></code></pre>
<h3 id="24-%E6%A8%A1%E5%9D%97%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5">2.4 模块级别的动态导入</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 适用于模块化的页面管理</span>
<span class="hljs-keyword">import</span> importlib

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_page</span><span class="hljs-params">(route)</span>:</span>
    module = importlib.import_module(<span class="hljs-string">f"pages.<span class="hljs-subst">{route}</span>_page"</span>)
    page_function = getattr(module, <span class="hljs-string">f"<span class="hljs-subst">{route}</span>_page_content"</span>)
    page_function()

load_page(<span class="hljs-string">'home'</span>)  <span class="hljs-comment"># 动态导入并执行 pages.home_page.home_page_content</span>
</div></code></pre>
<h2 id="3-%E5%BD%93%E5%89%8D%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8A%BF">3. 当前路由系统的设计优势</h2>
<h3 id="31-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8A%BF">3.1 性能优势</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 预编译的函数对象存储，无需运行时解析</span>
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content,        <span class="hljs-comment"># 函数对象引用</span>
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content
}

<span class="hljs-comment"># 调用时只是字典查找 + 函数调用，性能极佳</span>
handler = route_handlers[route]  <span class="hljs-comment"># O(1) 字典查找</span>
handler()                        <span class="hljs-comment"># 直接函数调用</span>
</div></code></pre>
<h3 id="32-%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8">3.2 类型安全</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># IDE 可以进行类型检查和自动补全</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, Callable

route_handlers: Dict[str, Callable[[], <span class="hljs-literal">None</span>]] = {
    <span class="hljs-string">'home'</span>: home_page_content,
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content
}
</div></code></pre>
<h3 id="33-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%8F%8B%E5%A5%BD">3.3 错误处理友好</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 清晰的错误边界</span>
<span class="hljs-keyword">if</span> route <span class="hljs-keyword">in</span> self.route_handlers:
    <span class="hljs-keyword">try</span>:
        self.route_handlers[route]()  <span class="hljs-comment"># 只可能是函数调用错误</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        print(<span class="hljs-string">f"页面 <span class="hljs-subst">{route}</span> 执行失败: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">else</span>:
    print(<span class="hljs-string">f"路由 <span class="hljs-subst">{route}</span> 不存在"</span>)  <span class="hljs-comment"># 配置错误</span>
</div></code></pre>
<h2 id="4-%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E7%8B%AC%E7%89%B9%E4%BC%98%E5%8A%BF">4. 脚本语言的独特优势</h2>
<h3 id="41-%E8%BF%90%E8%A1%8C%E6%97%B6%E7%81%B5%E6%B4%BB%E6%80%A7">4.1 运行时灵活性</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 可以在运行时动态添加路由</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_route</span><span class="hljs-params">(route_name, handler_function)</span>:</span>
    route_handlers[route_name] = handler_function

<span class="hljs-comment"># 运行时注册新页面</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_page_content</span><span class="hljs-params">()</span>:</span>
    ui.label(<span class="hljs-string">"新页面"</span>)

add_route(<span class="hljs-string">'new_page'</span>, new_page_content)
</div></code></pre>
<h3 id="42-%E5%85%83%E7%BC%96%E7%A8%8B%E8%83%BD%E5%8A%9B">4.2 元编程能力</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 可以通过代码生成代码</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_page_handler</span><span class="hljs-params">(page_name, content)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handler</span><span class="hljs-params">()</span>:</span>
        ui.label(<span class="hljs-string">f"<span class="hljs-subst">{page_name}</span>: <span class="hljs-subst">{content}</span>"</span>)
    <span class="hljs-keyword">return</span> handler

<span class="hljs-comment"># 批量生成页面处理器</span>
pages = [<span class="hljs-string">'user'</span>, <span class="hljs-string">'order'</span>, <span class="hljs-string">'product'</span>]
<span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> pages:
    route_handlers[page] = create_page_handler(page, <span class="hljs-string">f"<span class="hljs-subst">{page}</span> 管理页面"</span>)
</div></code></pre>
<h3 id="43-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8">4.3 装饰器模式的应用</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 可以动态包装函数</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">with_auth</span><span class="hljs-params">(func)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span><span class="hljs-params">()</span>:</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_is_authenticated():
            ui.label(<span class="hljs-string">"请先登录"</span>)
            <span class="hljs-keyword">return</span>
        func()
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 动态添加认证检查</span>
route_handlers[<span class="hljs-string">'admin'</span>] = with_auth(admin_page_content)
</div></code></pre>
<h2 id="5-%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0">5. 路由系统中的核心实现</h2>
<h3 id="51-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8%E7%9A%84%E8%B7%AF%E7%94%B1%E6%B3%A8%E5%86%8C">5.1 配置驱动的路由注册</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 配置阶段：定义路由映射</span>
menu_items = [
    {<span class="hljs-string">'key'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'home'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'home'</span>},
    {<span class="hljs-string">'key'</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'route'</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'仪表板'</span>, <span class="hljs-string">'icon'</span>: <span class="hljs-string">'dashboard'</span>}
]

<span class="hljs-comment"># 函数映射：路由名 -&gt; 处理函数</span>
route_handlers = {
    <span class="hljs-string">'home'</span>: home_page_content,
    <span class="hljs-string">'dashboard'</span>: dashboard_page_content
}
</div></code></pre>
<h3 id="52-%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6%E7%BB%91%E5%AE%9A">5.2 动态组件绑定</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 组件创建时绑定回调函数</span>
<span class="hljs-keyword">for</span> menu_item <span class="hljs-keyword">in</span> menu_items:
    <span class="hljs-keyword">with</span> ui.row() <span class="hljs-keyword">as</span> menu_row:
        ui.icon(menu_item[<span class="hljs-string">'icon'</span>])
        ui.label(menu_item[<span class="hljs-string">'label'</span>])

        <span class="hljs-comment"># 关键：使用闭包捕获配置信息</span>
        menu_row.on(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">lambda</span> key=menu_item[<span class="hljs-string">'key'</span>]:
                    self.select_menu_item(key))
</div></code></pre>
<h3 id="53-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91">5.3 事件处理与路由分发</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">select_menu_item</span><span class="hljs-params">(self, key: str)</span>:</span>
    <span class="hljs-string">"""处理菜单点击事件"""</span>
    <span class="hljs-comment"># 步骤1：根据 key 查找配置项</span>
    menu_item = next((item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.menu_items <span class="hljs-keyword">if</span> item[<span class="hljs-string">'key'</span>] == key), <span class="hljs-literal">None</span>)

    <span class="hljs-comment"># 步骤2：获取路由信息</span>
    <span class="hljs-keyword">if</span> menu_item <span class="hljs-keyword">and</span> menu_item.get(<span class="hljs-string">'route'</span>):
        route = menu_item[<span class="hljs-string">'route'</span>]
        label = menu_item[<span class="hljs-string">'label'</span>]

        <span class="hljs-comment"># 步骤3：执行路由跳转</span>
        self.navigate_to_route(route, label)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">navigate_to_route</span><span class="hljs-params">(self, route: str, label: str)</span>:</span>
    <span class="hljs-string">"""执行路由跳转"""</span>
    <span class="hljs-keyword">if</span> route <span class="hljs-keyword">in</span> self.route_handlers:
        <span class="hljs-comment"># 清空容器</span>
        self.content_container.clear()

        <span class="hljs-comment"># 执行路由处理函数</span>
        <span class="hljs-keyword">with</span> self.content_container:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 🎯 核心：动态函数调用</span>
                self.route_handlers[route]()
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                ui.label(<span class="hljs-string">f'页面加载失败: <span class="hljs-subst">{str(e)}</span>'</span>).classes(<span class="hljs-string">'text-red-500'</span>)
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">f"路由 <span class="hljs-subst">{route}</span> 不存在"</span>)
</div></code></pre>
<h2 id="6-lambda-%E9%97%AD%E5%8C%85%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3">6. Lambda 闭包机制详解</h2>
<h3 id="61-%E9%97%AD%E5%8C%85%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">6.1 闭包问题与解决方案</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># ❌ 常见错误：所有回调都指向最后一个值</span>
<span class="hljs-keyword">for</span> menu_item <span class="hljs-keyword">in</span> menu_items:
    <span class="hljs-comment"># 错误：menu_item.key 在循环结束后都是最后一个值</span>
    menu_row.on(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">lambda</span>: self.select_menu_item(menu_item[<span class="hljs-string">'key'</span>]))

<span class="hljs-comment"># ✅ 正确方案：使用默认参数捕获当前值</span>
<span class="hljs-keyword">for</span> menu_item <span class="hljs-keyword">in</span> menu_items:
    <span class="hljs-comment"># 正确：key=menu_item['key'] 创建闭包，捕获当前循环的值</span>
    menu_row.on(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">lambda</span> key=menu_item[<span class="hljs-string">'key'</span>]:
                self.select_menu_item(key))
</div></code></pre>
<h3 id="62-%E9%97%AD%E5%8C%85%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86">6.2 闭包机制原理</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 演示闭包捕获机制</span>
functions = []

<span class="hljs-comment"># 错误示例</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
    functions.append(<span class="hljs-keyword">lambda</span>: print(i))  <span class="hljs-comment"># 都会打印 2</span>

<span class="hljs-comment"># 正确示例</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
    functions.append(<span class="hljs-keyword">lambda</span> x=i: print(x))  <span class="hljs-comment"># 分别打印 0, 1, 2</span>

<span class="hljs-comment"># 调用测试</span>
<span class="hljs-keyword">for</span> func <span class="hljs-keyword">in</span> functions:
    func()
</div></code></pre>
<h2 id="7-%E6%80%A7%E8%83%BD%E4%B8%8E%E5%AE%89%E5%85%A8%E6%80%A7%E5%AF%B9%E6%AF%94">7. 性能与安全性对比</h2>
<h3 id="71-%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94%E8%A1%A8">7.1 性能对比表</h3>
<table>
<thead>
<tr>
<th>方法</th>
<th>查找时间</th>
<th>调用开销</th>
<th>安全性</th>
<th>推荐度</th>
</tr>
</thead>
<tbody>
<tr>
<td>字典映射</td>
<td>O(1)</td>
<td>极低</td>
<td>高</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>getattr</td>
<td>O(1)</td>
<td>低</td>
<td>高</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>动态导入</td>
<td>O(n)</td>
<td>中等</td>
<td>高</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td>eval 执行</td>
<td>O(n)</td>
<td>高</td>
<td>极低</td>
<td>⭐</td>
</tr>
</tbody>
</table>
<h3 id="72-%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91">7.2 安全性考虑</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># ✅ 安全的路由系统</span>
ALLOWED_ROUTES = {<span class="hljs-string">'home'</span>, <span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'profile'</span>}

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_navigate</span><span class="hljs-params">(route: str)</span>:</span>
    <span class="hljs-keyword">if</span> route <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> ALLOWED_ROUTES:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"不允许的路由: <span class="hljs-subst">{route}</span>"</span>)

    <span class="hljs-keyword">if</span> route <span class="hljs-keyword">in</span> route_handlers:
        route_handlers[route]()
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> KeyError(<span class="hljs-string">f"路由处理器不存在: <span class="hljs-subst">{route}</span>"</span>)

<span class="hljs-comment"># ❌ 不安全的动态执行</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsafe_navigate</span><span class="hljs-params">(route: str)</span>:</span>
    eval(<span class="hljs-string">f"<span class="hljs-subst">{route}</span>_page_content()"</span>)  <span class="hljs-comment"># 可被注入攻击</span>
</div></code></pre>
<h2 id="8-%E6%80%BB%E7%BB%93%E5%AF%B9%E6%AF%94">8. 总结对比</h2>
<table>
<thead>
<tr>
<th>特性</th>
<th>Python (动态语言)</th>
<th>Java/C# (静态语言)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>函数存储</strong></td>
<td><code>{'route': function}</code></td>
<td>需要接口或委托</td>
</tr>
<tr>
<td><strong>动态调用</strong></td>
<td><code>handlers[route]()</code></td>
<td>反射或设计模式</td>
</tr>
<tr>
<td><strong>运行时修改</strong></td>
<td>直接修改字典</td>
<td>需要复杂的工厂模式</td>
</tr>
<tr>
<td><strong>代码简洁性</strong></td>
<td>极简</td>
<td>相对复杂</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>优秀（预编译对象）</td>
<td>反射性能较差</td>
</tr>
<tr>
<td><strong>类型安全</strong></td>
<td>运行时检查</td>
<td>编译时检查</td>
</tr>
<tr>
<td><strong>开发效率</strong></td>
<td>高</td>
<td>中等</td>
</tr>
<tr>
<td><strong>维护成本</strong></td>
<td>低</td>
<td>高</td>
</tr>
</tbody>
</table>
<h2 id="9-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%BB%BA%E8%AE%AE">9. 实际应用建议</h2>
<h3 id="91-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">9.1 最佳实践</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 1. 使用类型提示增强代码可读性</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, Callable, Any

RouteHandler = Callable[[], <span class="hljs-literal">None</span>]
RouteConfig = Dict[str, Any]

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoutingSystem</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.handlers: Dict[str, RouteHandler] = {}
        self.config: List[RouteConfig] = []

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register_route</span><span class="hljs-params">(self, route: str, handler: RouteHandler)</span>:</span>
        <span class="hljs-string">"""注册路由处理器"""</span>
        self.handlers[route] = handler

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">navigate</span><span class="hljs-params">(self, route: str)</span>:</span>
        <span class="hljs-string">"""安全的路由导航"""</span>
        <span class="hljs-keyword">if</span> route <span class="hljs-keyword">in</span> self.handlers:
            <span class="hljs-keyword">try</span>:
                self.handlers[route]()
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                self.handle_error(route, e)
        <span class="hljs-keyword">else</span>:
            self.handle_missing_route(route)
</div></code></pre>
<h3 id="92-%E6%89%A9%E5%B1%95%E6%A8%A1%E5%BC%8F">9.2 扩展模式</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 2. 支持中间件的路由系统</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedRouter</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.handlers = {}
        self.middlewares = []

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_middleware</span><span class="hljs-params">(self, middleware)</span>:</span>
        <span class="hljs-string">"""添加中间件"""</span>
        self.middlewares.append(middleware)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">navigate</span><span class="hljs-params">(self, route: str)</span>:</span>
        <span class="hljs-string">"""带中间件的路由执行"""</span>
        <span class="hljs-comment"># 执行前置中间件</span>
        <span class="hljs-keyword">for</span> middleware <span class="hljs-keyword">in</span> self.middlewares:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> middleware.before_route(route):
                <span class="hljs-keyword">return</span>

        <span class="hljs-comment"># 执行路由处理器</span>
        <span class="hljs-keyword">if</span> route <span class="hljs-keyword">in</span> self.handlers:
            result = self.handlers[route]()

            <span class="hljs-comment"># 执行后置中间件</span>
            <span class="hljs-keyword">for</span> middleware <span class="hljs-keyword">in</span> reversed(self.middlewares):
                middleware.after_route(route, result)
</div></code></pre>
<hr>
<h2 id="%E7%BB%93%E8%AE%BA">结论</h2>
<p><code>self.route_handlers[route]()</code> 这行代码完美体现了 Python 作为动态语言的核心优势：</p>
<ol>
<li><strong>函数是对象</strong> - 可以存储在数据结构中</li>
<li><strong>动态查找</strong> - 运行时通过字符串 key 找到函数对象</li>
<li><strong>直接调用</strong> - 无需复杂的反射机制</li>
<li><strong>代码简洁</strong> - 一行代码完成复杂的路由分发</li>
</ol>
<p>这种设计在静态语言中需要更复杂的设计模式才能实现，而在 Python 中却如此自然和优雅！这就是为什么 Python 在快速原型开发、Web 框架、脚本自动化等领域如此受欢迎的原因之一。</p>

</body>
</html>
